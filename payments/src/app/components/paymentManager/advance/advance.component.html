<div class="advance-page">
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>
  
  <div *ngIf="loading" class="loading-spinner">
    Loading...
  </div>
  
  <div class="summary-cards">
    <div class="card light-blue">
      <h2>{{ totalAdvances }}</h2>
      <p>Total Advances</p>
    </div>
    <div class="card light-yellow">
      <h2>LKR {{ totalOutstandingAmount | number }}</h2>
      <p>Outstanding Amount</p>
    </div>
    <div class="card light-green">
      <h2>LKR {{ totalRecoveredAmount | number }}</h2>
      <p>Total Recovered</p>
    </div>
  </div>
  
  <div class="advance-container">
    <h3>Supplier Advances</h3>
    
    <div class="filters">
      <div class="filter-group">
        <label>Advance Type:</label>
        <select [(ngModel)]="selectedType" (change)="filterAdvances()">
          <option *ngFor="let type of advanceTypes" [value]="type">{{ type }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Supplier:</label>
        <select [(ngModel)]="selectedSupplier" (change)="filterAdvances()">
          <option value="">All Suppliers</option>
          <option *ngFor="let supplier of suppliers" [value]="supplier.SupplierId">
            {{ supplier.SupplierId }} - {{ supplier.Name }}
          </option>
        </select>
      </div>
      <div class="filter-group">
        <div class="export-buttons">
          <button class="export-btn" (click)="exportAdvancesData('CSV')">Export CSV</button>
          <button class="export-btn" (click)="exportAdvancesData('EXCEL')">Export Excel</button>
        </div>
      </div>
    </div>
  
    <div class="manual-entry">
      <h4>Add New Advance</h4>
      <form [formGroup]="advanceForm" (ngSubmit)="addAdvance()">
        <div class="form-grid">
          <div class="form-group">
            <label>Supplier:</label>
            <select formControlName="SupplierId">
              <option value="">Select Supplier</option>
              <option *ngFor="let supplier of suppliers" [value]="supplier.SupplierId">
                {{ supplier.SupplierId }} - {{ supplier.Name }}
              </option>
            </select>
            <div *ngIf="advanceForm.get('SupplierId')?.touched && advanceForm.get('SupplierId')?.invalid" class="error-message">
              Supplier is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Advance Type:</label>
            <select formControlName="AdvanceType">
              <option value="">Select Type</option>
              <option *ngFor="let type of advanceTypes.slice(1)" [value]="type">{{ type }}</option>
            </select>
            <div *ngIf="advanceForm.get('AdvanceType')?.touched && advanceForm.get('AdvanceType')?.invalid" class="error-message">
              Advance type is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Description:</label>
            <input type="text" formControlName="Purpose" placeholder="Enter description" />
            <div *ngIf="advanceForm.get('Purpose')?.touched && advanceForm.get('Purpose')?.invalid" class="error-message">
              Description is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Amount (LKR):</label>
            <input type="number" formControlName="AdvanceAmount" placeholder="Enter amount" />
            <div *ngIf="advanceForm.get('AdvanceAmount')?.touched && advanceForm.get('AdvanceAmount')?.invalid" class="error-message">
              Valid amount is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Issue Date:</label>
            <input type="date" formControlName="IssueDate" />
            <div *ngIf="advanceForm.get('IssueDate')?.touched && advanceForm.get('IssueDate')?.invalid" class="error-message">
              Issue date is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Recovered Amount (LKR):</label>
            <input type="number" formControlName="RecoveredAmount" />
          </div>
          
          <div class="form-group">
            <label>Balance Amount (LKR):</label>
            <input type="number" formControlName="BalanceAmount" readonly />
            <div *ngIf="advanceForm.get('BalanceAmount')?.touched && advanceForm.get('BalanceAmount')?.invalid" class="error-message">
              Valid balance amount is required
            </div>
          </div>
          
          <div class="form-group">
            <button type="submit" class="add-btn" [disabled]="loading">
              {{ loading ? 'Adding...' : 'Add Advance' }}
            </button>
          </div>
        </div>
      </form>
    </div>
  
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Advance ID</th>
            <th>Supplier ID</th>
            <th>Type</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Issue Date</th>
            <th>Recovered Amount</th>
            <th>Balance Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let advance of filteredAdvances">
            <td>{{ advance.AdvanceId }}</td>
            <td>{{ advance.SupplierId }}</td>
            <td>{{ advance.AdvanceType }}</td>
            <td>{{ advance.Purpose }}</td>
            <td>LKR {{ advance.AdvanceAmount | number }}</td>
            <td>LKR {{ advance.RecoveredAmount | number }}</td>
            <td>LKR {{ advance.BalanceAmount | number }}</td>
          </tr>
          <tr *ngIf="filteredAdvances.length === 0">
            <td colspan="8" class="no-data">No advances found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
